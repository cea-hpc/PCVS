#!/bin/sh
REQUIRE_OPENMP="true"

if [ -z "$OMP_NUM_THREADS" ] || [ $OMP_NUM_THREADS -eq 1 ] ;then
  MPC_OPENMP_THREAD_LIST=$CLUSTER_MAX_CORES_PER_NODE
else
  MPC_OPENMP_THREAD_LIST=$OMP_NUM_THREADS
fi

# Catch original CFLAGS
ORIGINAL_CFLAGS=${CFLAGS}

#add openmp cflags
CFLAGS="${ORIGINAL_CFLAGS} -fopenmp ${PRIVATIZATION}"

#call existing simple configuration
openmp_configuration "" "
allocatable1.f90
allocatable2.f90
allocatable3.f90
allocatable4.f90
allocatable5.f90
allocatable6.f90
allocatable7.f90
allocatable8.f90
character1.f90
character2.f90
collapse1.f90
collapse2.f90
collapse3.f90
collapse4.f90
condinc1.f
condinc3.f90
do1.f90
do2.f90
jacobi.f
lastprivate1.f90
lastprivate2.f90
lib1.f90
lib2.f
lib3.f
lib4.f90
lock-1.f90
lock-2.f90
nested1.f90
nestedfn1.f90
nestedfn2.f90
nestedfn3.f90
nestedfn4.f90
omp_atomic1.f90
omp_atomic2.f90
omp_atomic3.f90
omp_atomic4.f90
omp_cond3.f90
omp_cond4.f90
omp_hello.f
omp_orphan.f
omp_parse1.f90
omp_parse2.f90
omp_parse3.f90
omp_parse4.f90
omp_reduction.f
omp_workshare1.f
omp_workshare2.f
pointer1.f90
pointer2.f90
pr25162.f
pr25219.f90
pr27395-1.f90
pr27395-2.f90
pr27416-1.f90
pr27916-1.f90
pr27916-2.f90
pr28390.f
pr29629.f90
pr32359.f90
pr32550.f90
pr33880.f90
pr34020.f90
pr35130.f90
pr42162.f90
pr46753.f90
pr48894.f90
pr49792-1.f90
pr49792-2.f90
recursion1.f90
reduction1.f90
reduction2.f90
reduction3.f90
reduction4.f90
reduction5.f90
reduction6.f90
reference1.f90
reference2.f90
retval1.f90
retval2.f90
sharing1.f90
sharing2.f90
stack.f90
strassen.f90
tabs1.f90
tabs2.f
task1.f90
task2.f90
task3.f90
task4.f90
threadprivate1.f90
threadprivate2.f90
threadprivate3.f90
threadprivate4.f90
use_intrinsic_1.f90
vla1.f90
vla2.f90
vla3.f90
vla4.f90
vla5.f90
vla6.f90
vla7.f90
vla8.f90
workshare1.f90
workshare2.f90
"

CFLAGS="${ORIGINAL_CFLAGS} -fopenmp -fcray-pointer"
openmp_configuration "" "
crayptr1.f90
crayptr2.f90
crayptr3.f90
"

# Run programs that require no OpenMP support
CFLAGS="${ORIGINAL_CFLAGS}"
openmp_configuration "" "
condinc2.f
condinc4.f90
"
