#!/bin/sh

REQUIRE_OPENMP=true

CLASS="S W A"
MPC_OPENMP_THREAD_LIST="1 2 4"
MPC_PROC_NB_LIST=1
MPC_TASK_NB_LIST=1
MPC_THREAD_NB_LIST=1
NAS_TYPE="bt-mz lu-mz sp-mz"

MPC_AUTO_KILL_TIMEOUT=900

if test ! -d ${MPC_TEST_CURRENT_SOURCE_DIR}/bin; then
	mkdir ${MPC_TEST_CURRENT_SOURCE_DIR}/bin
fi

makefile_configuration "compile_NAS" "suite"

echo "" > ${MPC_TEST_CURRENT_SOURCE_DIR}/config/suite.def

for type in ${NAS_TYPE}
do
	for i in ${CLASS}
	do
		echo "$type	$i" >> ${MPC_TEST_CURRENT_SOURCE_DIR}/config/suite.def

		#calc test name by removing file extention
    	test_exe="${MPC_TEST_CURRENT_SOURCE_DIR}/bin/$type.$i"
	
		for openmp_thread in ${MPC_OPENMP_THREAD_LIST}	    
		do
			for thread in ${MPC_THREAD_LIST}
			do
				#gen options
				opts="--clean --autokill=${MPC_AUTO_KILL_TIMEOUT} -N=1 -n=1 -p=1 -net=tcp -m=${thread}"

				#gen command
				command="OMP_NUM_THREADS=$openmp_thread ${MPCRUN} ${opts} ${MPCRUN_ARGS} ${test_exe} ${COMMAND_OPTIONS}"

				#insert test
				common_insert_test "test_${type}_class_${i}_${openmp_thread}_${thread}" "${EXPECTED_EXIT_CODE}" "$command" "compile_NAS"
			done
		done
	done
done
