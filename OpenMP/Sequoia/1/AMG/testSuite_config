#!/bin/sh

REQUIRE_OPENMP=true


set_openmp_threads_list

MPC_PROC_NB_LIST=1
MPC_TASK_NB_LIST=1
MPC_THREAD_NB_LIST=1
TYPE="AMG"

makefile_configuration "compile_Sequoia_${TYPE}" 

for openmp_thread in ${MPC_OPENMP_THREAD_LIST}	    
do
	for thread in ${MPC_THREAD_LIST}
	do
	
		# Gen options
		opts="--clean --autokill=${MPC_AUTO_KILL_TIMEOUT} -N=1 -n=1 -p=1 -net=tcp -m=${thread}"

		
		COMMAND_OPTIONS="-in ${MPC_TEST_CURRENT_SOURCE_DIR}/test/sstruct.in.AMG.FD"
		# Gen command
		command="OMP_NUM_THREADS=$openmp_thread ${MPCRUN} ${opts} ${MPCRUN_ARGS} ${MPC_TEST_CURRENT_SOURCE_DIR}/test/amg2006 ${COMMAND_OPTIONS}"

		# Insert test
		common_insert_test "test_${TYPE}_${openmp_thread}_${thread}" "${EXPECTED_EXIT_CODE}" "$command" "compile_Sequoia_${TYPE}"
	done
done
